import { Button, LineEdit, GroupBox, VerticalBox, ComboBox, HorizontalBox, ScrollView } from "sixtyfps_widgets.60";

export global CommitMethodValues := {
    property <[string]> values: ["Copy to target directory", 
                                "Move to target directory", 
                                "Move to target directory and delete in source directory",
                                "Delete in source directory"];
}

struct CommitResult := {
    result: string,
    color: string,
}

export CommitView := HorizontalBox { 
    property <[CommitResult]> commit-result-model;
    property target-directory <=> target-directory-edit.text;
    property commit-method <=> commit-method-combo-box.current-index;
    property commit-method-value <=> commit-method-combo-box.current-value;    

    // Commit
    property <bool> commit-running: false;
    property <bool> commit-done: false;

    // Warning
    property <bool> show-warning: false;

    // Called when the commit button was pressed
    callback commit;

    // Called when source or target was browsed
    callback browse-target;

    VerticalBox { 
        alignment: start;

            GroupBox { 
            title: "Target directory";
            enabled: commit-method-combo-box.current-index != 3;
            
            HorizontalBox { 
                spacing: 5px;
                target-directory-edit := LineEdit { 
                    width: 400px;
                    enabled: !commit-running && commit-method-combo-box.current-index != 3;
                    placeholder-text: "Select target directory";
                }
                Button {
                    text: "\u{1F4C2} Browse...";
                    width: 200px;
                    enabled: !commit-running && commit-method-combo-box.current-index != 3;
                    clicked => { 
                        browse-target();
                    }
                }
            }
        }
        GroupBox { 
            title: "Sieve method";
            HorizontalBox { 
                spacing: 5px;
                commit-method-combo-box := ComboBox {
                    enabled: !commit-running;
                    width: 400px;
                    model: CommitMethodValues.values;
                }
            }
        }

        Button {
            text: "\u{2705} Start";
            width: 300px;
            enabled: !commit-running;
            clicked => {
                if (commit-method-combo-box.current-index == 2 || commit-method-combo-box.current-index == 3) {
                    show-warning = true;
                    commit-running = true;
                } else {
                    commit-done = true;
                    commit();                    
                }
            }
        }

        GroupBox {
            title: "Warning! The desired sieve method will delete files that cannot be recovered.\n\nAre you sure you want to proceed?";
            visible: show-warning;
            HorizontalBox { 
                spacing: 5px;
                Button {
                    text: "\u{2705} Yes";
                    width: 300px;
                    visible: show-warning;
                    clicked => {            
                        show-warning = false;
                        commit-done = true;
                        commit();                    
                    }
                }
                Button {
                    text: "\u{274C} No";
                    width: 300px;
                    visible: show-warning;
                    clicked => {            
                        show-warning = false;
                        commit-running = false;
                    }
                }
            }
        }
    }  

    ScrollView {
        visible: commit-done;

        VerticalBox { 
        for item[i] in commit-result-model:
            Text {
                text: item.result;               
                color: item.color == "red" ? red : (item.color == "green" ? green : black);
            }
        }
    }
}