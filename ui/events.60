import { ListView, Button, LineEdit, GroupBox, VerticalBox, ScrollView } from "sixtyfps_widgets.60";


struct Event := {
    name: string,
    start-date: string,
    end-date: string
}

EventsView := ScrollView { 
    property <[Event]> events-model;
    callback add-event(string, string, string);
    callback check-event(string, string, bool) -> string;
    callback date-valid(string) -> bool;
    callback remove-event(int);
    callback update-event(int);

    VerticalBox { 
        alignment: start;

        for item[i] in events-model: GroupBox {             
            title: item.name + ", " + item.start-date + " - " + item.end-date;
            padding: 5px;
            GridLayout {
                spacing: 5px;
                padding: 5px;
                Text {
                    text: "Event name";
                    vertical-alignment: center;
                }
                event-name := LineEdit { 
                    text: item.name;
                    accepted => {
                        item.name = event-name.text;
                        update-event(i);
                    }
                }
                Text {
                    text: "\u{1F4C5} Start date";
                    row: 1;
                    vertical-alignment: center;
                }
                start-date := LineEdit { 
                    text: item.start-date;
                    accepted => {
                        if (date-valid(start-date.text) && "" == check-event(start-date.text, item.end-date, false)) {
                            item.start-date = start-date.text;
                            update-event(i);
                        }
                        else {
                            start-date.text = item.start-date;
                        }
                    }
                }
                Text {
                    text: "\u{1F4C5} End date";
                    row: 2;
                    vertical-alignment: center;
                }
                end-date := LineEdit { 
                    text: item.end-date;
                    accepted => {
                        if (date-valid(end-date.text) && "" == check-event(item.start-date, end-date.text, false)) {
                            item.end-date = end-date.text;
                            update-event(i);
                        }
                        else {
                            end-date.text = item.end-date;
                        }
                    }
                }
            }
            Button {
                width: 300px;
                text: "\u{1F5D1} Remove";
                clicked => { remove-event(i) }
            }
        }
        GroupBox { 

            title: "New event";
            VerticalBox { 
                alignment: start;
                new-name := LineEdit { 
                    placeholder-text: "Event name";
                }
                new-start-date := LineEdit { 
                    placeholder-text: "Start date (YYYY-MM-DD or DD-MM-YYYY)";
                }
                new-end-date := LineEdit { 
                    placeholder-text: "End date (YYYY-MM-DD or DD-MM-YYYY)";
                }
                Button {
                    text: "\u{2795} Add";
                    width: 300px;
                    clicked => { 
                        error-message.visible = false;
                        if (date-valid(new-start-date.text) && date-valid(new-end-date.text)) {
                            error-message.text = check-event(new-start-date.text, new-end-date.text, true);
                            if (error-message.text == "") {                            
                                add-event(new-name.text, new-start-date.text, new-end-date.text);
                                new-name.text = "";
                                new-start-date.text = "";
                                new-end-date.text = "";
                            }
                            else {
                                error-message.visible = true;
                            }
                        } else {
                            error-message.text = "Invalid date";
                            error-message.visible = true;
                        }
                    }
                }
                error-message := Text {
                    text: "";
                    color: red;
                    visible: false;
                }
            }
        }
    }
}